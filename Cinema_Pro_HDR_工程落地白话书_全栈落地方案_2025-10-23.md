# 一、全景图：我们要把什么装到哪儿？

**产物清单（软件/算法）**

1. **核心库（C++，`cinema-pro-hdr-core`）**：PPR/RLOG 曲线、OKLab 饱和、细节层、色域回扣、PQ/色彩矩阵、ΔE/统计。
2. **DCTL 原型**：`CPH_PPR.dctl`、`CPH_RLOG.dctl` —— 给达芬奇里即时预览用。
3. **OFX 插件（`CinemaProHDR.ofx.bundle`）**：正式 UI、批量应用、侧车导出、统计面板。
4. **工具链**：`cph_lut_baker`（LUT 烘焙/误差报告）、`cph_json_check`（侧车校验）、批处理脚本。
5. **侧车 JSON Schema**：`cph.schema.json`（含 2094-10 基础层 + CPH 扩展块）。
6. **文档包**：用户手册、API、验收报告模板、DCI 合规报告模板。
7. **样片与 Golden 基线**：对比与回归的“金标准”。

**它们分别装到哪儿？**

* **后期工作站（Windows/macOS）**：达芬奇（DCTL + OFX），日常调色使用；安装工具链。
* **渲染农场/自动化机器**：只装核心库 + 工具链，用来批量烘焙 LUT 和生成侧车/报告。
* **DCP/打包工具侧**：集成工具链或调用 CLI，导出 DCP 时附侧车并输出合规报告。
* **影院放映服务器 PoC**：读取 2094-10 基础层；若识别 CPH 扩展则启用增强，否则“标准回退”。
* **内测监看设备**（HDR 参考监视器）：用 LUT 实时监看（即使没装插件也能看近似效果）。

---

# 二、落地矩阵：模块×系统×设备（干什么、谁用、产出）

| 模块/算法       | 系统/设备               | 谁用             | 干什么                                           | 产出/接口                 |
| --------------- | ----------------------- | ---------------- | ------------------------------------------------ | ------------------------- |
| 核心库 `core` | Win/macOS/Linux         | 工程师/自动化    | 提供 API：PPR/RLOG、OKLab、细节层、色域回扣、ΔE | 静态/动态库、C++ 头、示例 |
| DCTL            | DaVinci Resolve         | 调色师           | 快速预览/校味、拉参数、看三预设                  | 实时画面；参数快照        |
| OFX 插件        | DaVinci/支持 OFX 的宿主 | 调色师/后期      | 正式 UI、批量、统计、侧车导出                    | .ofx.bundle、.cph.json    |
| LUT 烘焙器      | 任意（命令行）          | 工程/技术美术    | 33³/65³ LUT 烘焙、误差评估                     | .cube + JSON 报告         |
| 侧车校验器      | 任意（命令行）          | 发行/制片/自动化 | 校验/回退决策、错误码输出                        | 退出码/日志/修复建议      |
| DCI 合规检查    | 打包/发行机             | 发行/放映对接    | 白点黑位/色域边界/EOTF 标识检查                  | 合规报告（pass/fail）     |
| 放映服务器 PoC  | 影院测试机              | 放映工程师       | 识别 CPH 扩展；不识别则按 2094-10                | 放映实测视频/观感反馈     |

---

# 三、三条典型工作流（一句话看懂）

### 工作流 A：后期调色（“今天就能用”）

1. 调色师在达芬奇装 DCTL/OFX → 载入素材。
2. 选择 **PPR/RLOG**，拉五个旋钮（Pivot、Shadow/Highlight、Roll-off、Detail、Black Lift）。
3. 统计面板显示 **min/avg/max PqMaxRGB**；看预设 A/B。
4. 导出：**LUT**（便携）+ **侧车 JSON**（参数）+ **报告**（ΔE/单调/性能）。
5. 团队内其他人，即使没装插件，也可用 LUT 近似看效果。

### 工作流 B：发行打包（“去影院放映”）

1. 把最终时间线参数导出成 **.cph.json**；DCP 工具集成 `cph_json_check`。
2. 打包时附上 **2094-10 基础层** + **CPH 扩展块**（读不懂也能放）。
3. 开启 **DCI 合规模式**：检查 P3-D65 色容积、白点/黑位、EOTF 信令；出 **合规报告**。
4. 放映前厅测：识别 CPH → 增强；不识别 → 画面正常回退。

### 工作流 C：内容库/OTT/片方评审（“统一效果”）

1. 渲染农场用 **LUT** + **侧车** 批处理生成多终端观片版本（例如 SDR 审片）。
2. ΔE 报告和闪烁谱图自动生成 → 片方有据可依。
3. 归档 **Goldens** 与参数 → 同一片子未来复刻毫无压力。

---

# 四、工程实施白话（从三种角色看）

## 1) 规划者（产品/制片/技术负责人）

* **要点**：兼容在先、增强在后。老人设备吃 **2094-10**；新设备吃 **CPH 扩展**。
* **节奏**：**M1 出样**（DCTL+LUT+侧车+报告）→ **M2 上线**（OFX 正式、合规报告）。
* **决策点**：α版定味（曲线参数域）、β版定 UI、RC 版走 DCI 报审。
* **指标**：ΔE00（色差）、闪烁（1–6 Hz）、性能（4K <1ms）、A/B 偏好 ≥60%。

## 2) 实施者（工程/后期系统/自动化）

* **干活路径**：

  * 在 **核心库** 上开发，DCTL/OFX/CLI 共用同一个实现，便于测试对齐。
  * CI 自动跑 **四大报告**：单调/C¹、ΔE、性能、闪烁；失败即退回。
  * DCI 合规与色域越界作为 **独立检查**，不绑死渲染。
* **接口**：C++ API、命令行、JSON schema，全部固定；跨平台（Win/macOS/Linux）同一套。
* **交付**：.ofx、.dctl、.exe/.sh、schema、文档包、样片与 Goldens。

## 3) 使用者（调色师/放映工程师/片方）

* **调色师**：像平时拉曲线，但更简单；一键导出 **LUT+侧车**，不怕环境不同。
* **放映工程师**：看“合规报告”是否通过；识别 CPH 扩展则增强，不识别也不出问题。
* **片方**：拿到可对比的报告、可复现的参数，**减少反复**。

---

# 五、你做出来之后怎么赚钱/扩散（专利、标准、SDK）

## 1) 专利

* **专利点**：

  * 算法：**PPR（枢轴幂-有理式）/RLOG（对数-有理式）** 的数学形式与连续性约束；
  * 数据结构：**CPH 扩展块**（cph_version/curve_id/pivot…）侧车/SEI 封装；
  * 交互系统：**五旋钮映射**（Pivot/Shadow/Highlight/Roll-off/Detail）。
* **怎么用**：

  * **防御性**：堵住“换个名字抄过去”；
  * **授权性**：向**后期软件厂商、放映服务器厂商、监视器厂商**收许可费（SDK/年费/每终端授权）。
* **落地**：在发行合同/技术交付清单中写“使用 Cinema Pro HDR（CPH）技术”，专利号/申请号披露。

## 2) 标准化与生态

* **短期**：内部/行业 **技术白皮书**，对外发布 **RDD（推荐做法）**；与合作院线/影节跑 PoC。
* **中期**：推动成为**协会标准/企业标准**，例如把 CPH 扩展块登记为公开 Schema（便于生态读写）。
* **长期**：与 DCI/HDR 相关工作组对接，提交“扩展元数据建议稿”；国内可对接 GY/T 或协会标准路线。

## 3) SDK/集成

* **SDK**：把核心库打成 **CPH SDK**（二进制 + 头文件 + 示例），提供**商业授权**。
* **典型集成对象**：达芬奇/基于 OFX 的工具、Nuke、Mistika、色域管理工具、DCP 工具、放映服务器、监视器 LUT 管线。
* **商业价值**：

  * 降低“同片不同厅不同味”的投诉成本；
  * 提供“导演意图保真”的卖点；
  * 可作为“国产自主 HDR 电影工作流”的 **标配组件**。

---

# 六、运维与交付模式（你需要什么团队动作）

* **CI/CD**：每次提交自动生成四图（ΔE/单调/C¹/性能）、合规报告样本、worst10 色点表。
* **版本 SKU**：

  * 开源/社区版（仅工具链和 DCTL，限功能）；
  * 专业版（OFX + SDK + 合规报告 + 支持）；
  * 企业/院线版（PoC/服务器适配 + 咨询/培训）。
* **支持与培训**：给调色团队 2 小时快速上手课；给发行/放映 1 小时合规报告解读培训。
* **SLA（服务级别）**：重大交付前 48 小时内响应；合规失败提供定位报告。

---

# 七、风险与兜底（工程视角实话实说）

* **GPU 数值差异**：默认模式轻微差异可接受；**确定性模式**用于最终交付对齐。
* **高光“呼吸感”**：默认阈值足够稳；如遇极端镜头，自动降 `λ_hd` 或关闭细节层。
* **色域塌缩**：极端霓虹会触发二级感知夹持；DCI 模式对 `sat_hi` 做 5–10% 保守衰减。
* **生态兼容**：读不懂 CPH 的设备仍然有 2094-10 基础渲染；永远不黑屏——这是生命线。

---

# 八、未来三步走（把今天的产品，变成明天的行业习惯）

1. **把“导演意图保真”打成口号**：在片尾/物料上标注“Cinema Pro HDR Grading”，做品牌。
2. **发白皮书 + 影厅样片**：挑两部片做案例，发布前后对比视频和报告，建立口碑。
3. **生态合作**：

   * 与一到两家**放映服务器**厂商完成 CPH 扩展解析；
   * 与**监视器**厂商联名做“CPH 模式”；
   * 与**后期软件**洽谈内置（SDK 授权）。

---

# 九、给三类人的“30 秒电梯陈述”

* **给老板**：这是一套**标准兼容 + 创作增强**的 HDR 电影工作流。短期能提质降本，长期能形成专利壁垒和标准话语权。
* **给工程师**：同一套核心库跑三端（DCTL/OFX/CLI），CI 自动出四类报告，确定性模式保障一致；落地省心。
* **给调色师**：五个旋钮 + 三个预设，味道好调、可回撤、可复现；导出 LUT/侧车，走到哪儿都保持风格。