# Cinema Pro HDR DCTL å®ç°

## æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«Cinema Pro HDRç³»ç»Ÿçš„DCTLï¼ˆDaVinci Color Transform Languageï¼‰å®ç°ï¼Œç”¨äºåœ¨DaVinci Resolveä¸­æä¾›å®æ—¶HDRè‰²è°ƒæ˜ å°„åŠŸèƒ½ã€‚

## æ–‡ä»¶ç»“æ„

```
src/dctl/
â”œâ”€â”€ cinema_pro_hdr.dctl              # ä¸»DCTLå®ç°æ–‡ä»¶
â”œâ”€â”€ cinema_pro_hdr_optimized.dctl    # æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬
â”œâ”€â”€ parameter_mapping.h              # UIå‚æ•°æ˜ å°„å·¥å…·
â”œâ”€â”€ statistics_collector.cpp         # ç»Ÿè®¡æ”¶é›†å™¨å®ç°
â””â”€â”€ README.md                       # æœ¬æ–‡æ¡£
```

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **åŒæ›²çº¿æ”¯æŒ**ï¼šPPRï¼ˆPivoted Power-Rationalï¼‰å’ŒRLOGï¼ˆRational Logarithmicï¼‰
- **å®æ—¶å¤„ç†**ï¼šGPUä¼˜åŒ–ï¼Œæ”¯æŒ4K@24på®æ—¶å¤„ç†
- **å‚æ•°æ˜ å°„**ï¼šUIæ§ä»¶åˆ°ç®—æ³•å‚æ•°çš„è‡ªåŠ¨è½¬æ¢
- **ç»Ÿè®¡æ”¶é›†**ï¼šå®æ—¶PQ MaxRGBç»Ÿè®¡å’Œæ€§èƒ½ç›‘æ§
- **æ•°å€¼ç¨³å®š**ï¼šå®Œæ•´çš„NaN/Infä¿æŠ¤å’Œå›é€€æœºåˆ¶

### ğŸš€ æ€§èƒ½ä¼˜åŒ–
- **æ··åˆç²¾åº¦**ï¼šFP16+FP32æ··åˆç²¾åº¦è®¡ç®—
- **åˆ†æ”¯ä¼˜åŒ–**ï¼šä½¿ç”¨æƒé‡æ··åˆé¿å…GPUåˆ†æ”¯
- **å‘é‡åŒ–**ï¼šGPUå‹å¥½çš„å‘é‡åŒ–æ“ä½œ
- **é¢„è®¡ç®—**ï¼šå¸¸æ•°é¢„è®¡ç®—å‡å°‘è¿è¡Œæ—¶å¼€é”€

### ğŸ¨ è‰²å½©ç®¡ç†
- **å·¥ä½œåŸŸ**ï¼šBT.2020+PQå½’ä¸€åŒ–å¤„ç†
- **OKLabé¥±å’Œåº¦**ï¼šæ„ŸçŸ¥å‡åŒ€çš„é¥±å’Œåº¦è°ƒèŠ‚
- **è‰²åŸŸå¤„ç†**ï¼šä¸¤çº§è‰²åŸŸè¶Šç•Œå¤„ç†æœºåˆ¶
- **DCIåˆè§„**ï¼šæ”¯æŒDCIåˆè§„æ¨¡å¼

## ä½¿ç”¨æ–¹æ³•

### 1. åœ¨DaVinci Resolveä¸­å®‰è£…

1. å°†`cinema_pro_hdr.dctl`æ–‡ä»¶å¤åˆ¶åˆ°Resolveçš„DCTLç›®å½•ï¼š
   - **Windows**: `%APPDATA%\Blackmagic Design\DaVinci Resolve\Support\LUT\`
   - **macOS**: `~/Library/Application Support/Blackmagic Design/DaVinci Resolve/LUT/`
   - **Linux**: `~/.local/share/DaVinciResolve/LUT/`

2. é‡å¯DaVinci Resolve

3. åœ¨Coloré¡µé¢çš„èŠ‚ç‚¹ä¸­å³é”®é€‰æ‹©"DCTL" â†’ "Cinema Pro HDR"

### 2. å‚æ•°é…ç½®

#### åŸºç¡€å‚æ•°
- **Curve Type**: 0=PPR, 1=RLOG
- **Pivot**: æ¢è½´ç‚¹ï¼Œå»ºè®®0.18ï¼ˆå¯¹åº”180 nitsï¼‰
- **Deterministic Mode**: ç¡®å®šæ€§æ¨¡å¼ï¼Œç”¨äºè·¨å¹³å°ä¸€è‡´æ€§

#### PPRå‚æ•°ï¼ˆå½“Curve Type=0æ—¶ï¼‰
- **Gamma Shadows**: é˜´å½±ä¼½é©¬ [1.0, 1.6]
- **Gamma Highlights**: é«˜å…‰ä¼½é©¬ [0.8, 1.4]  
- **Shoulder**: è‚©éƒ¨å‚æ•° [0.5, 3.0]

#### RLOGå‚æ•°ï¼ˆå½“Curve Type=1æ—¶ï¼‰
- **RLOG A**: æš—éƒ¨å‚æ•° [1.0, 16.0]
- **RLOG B**: é«˜å…‰å¢ç›Š [0.8, 1.2]
- **RLOG C**: é«˜å…‰å‹ç¼© [0.5, 3.0]
- **RLOG T**: æ‹¼æ¥é˜ˆå€¼ [0.4, 0.7]

#### é«˜çº§å‚æ•°
- **Soft Knee**: è½¯è†ç‚¹ä½ç½® [0.95, 0.99]
- **Knee Alpha**: è½¯è†å¼ºåº¦ [0.2, 1.0]
- **Toe Clamp**: toeå¤¹æŒ [0.0, 0.01]
- **Highlight Detail**: é«˜å…‰ç»†èŠ‚å¼ºåº¦ [0.0, 1.0]
- **Saturation Base**: åŸºç¡€é¥±å’Œåº¦ [0.0, 2.0]
- **Saturation Highlights**: é«˜å…‰é¥±å’Œåº¦ [0.0, 2.0]

### 3. é¢„è®¾ä½¿ç”¨

ç³»ç»Ÿæä¾›ä¸‰å¥—é¢„è®¾å‚æ•°ï¼š

#### Cinema-Flatï¼ˆå¹³ç¼“è‡ªç„¶ï¼‰
```
Pivot: 0.18, Gamma S: 1.10, Gamma H: 1.05, Shoulder: 1.0
Black Lift: 0.003, Highlight Detail: 0.2
Sat Base: 1.00, Sat Hi: 0.95
```

#### Cinema-Punchï¼ˆå¢å¼ºå¯¹æ¯”ï¼‰
```
Pivot: 0.18, Gamma S: 1.40, Gamma H: 1.10, Shoulder: 1.8
Black Lift: 0.002, Highlight Detail: 0.4
Sat Base: 1.05, Sat Hi: 1.00
```

#### Cinema-Highlightï¼ˆé«˜å…‰ä¿æŠ¤ï¼‰
```
Pivot: 0.20, Gamma S: 1.20, Gamma H: 0.95, Shoulder: 1.2
Black Lift: 0.004, Highlight Detail: 0.6
Sat Base: 0.98, Sat Hi: 0.92
```

## UIå‚æ•°æ˜ å°„

### PPRæ˜ å°„å…¬å¼
- **Shadows Contrast** (Sâˆˆ[0,1]) â†’ Î³s = 1.0 + 0.6Ã—S
- **Highlight Contrast** (Hâˆˆ[0,1]) â†’ Î³h = 0.8 + 0.6Ã—H
- **Highlights Roll-off** (Râˆˆ[0,1]) â†’ h = 0.5 + 2.5Ã—R
- **Pivot (Nits)** â†’ é€šè¿‡PQ OETFè½¬æ¢ä¸ºå½’ä¸€åŒ–å€¼

### RLOGæ˜ å°„å…¬å¼
- **Shadow Lift** (Sâˆˆ[0,1]) â†’ a = 1 + 15Ã—S
- **Highlight Gain** (Gâˆˆ[0,1]) â†’ b = 0.8 + 0.4Ã—G
- **Highlight Roll-off** (Râˆˆ[0,1]) â†’ c = 0.5 + 2.5Ã—R
- **Blend Threshold** (Bâˆˆ[0,1]) â†’ t = 0.4 + 0.3Ã—B

## æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æ€§èƒ½
- **4K@24p**: < 1.0ms/å¸§ï¼ˆä¸­ä½æ•°ï¼‰ï¼Œ< 1.2msï¼ˆP95ï¼‰
- **8K@24p**: < 3.5ms/å¸§ï¼ˆä¸­ä½æ•°ï¼‰ï¼Œ< 4.0msï¼ˆP95ï¼‰

### æµ‹è¯•å¹³å°
- **NVIDIA**: RTX 3080, Windows 11, Studioé©±åŠ¨
- **Apple**: M2 Max, macOS 14
- **AMD**: RX 6800 XT, Windows 11

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. **ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬**ï¼šå¯¹äºé«˜åˆ†è¾¨ç‡å†…å®¹ï¼Œä½¿ç”¨`cinema_pro_hdr_optimized.dctl`
2. **å¯ç”¨ç¡®å®šæ€§æ¨¡å¼**ï¼šåœ¨éœ€è¦è·¨å¹³å°ä¸€è‡´æ€§æ—¶å¯ç”¨
3. **åˆç†è®¾ç½®å‚æ•°**ï¼šé¿å…æç«¯å‚æ•°å€¼ï¼Œä¿æŒåœ¨æ¨èèŒƒå›´å†…
4. **ç›‘æ§ç»Ÿè®¡ä¿¡æ¯**ï¼šä½¿ç”¨ç»Ÿè®¡æ”¶é›†å™¨ç›‘æ§æ€§èƒ½

## ç»Ÿè®¡æ”¶é›†

### å®æ—¶ç»Ÿè®¡
- **Min/Avg/Max PQ MaxRGB**: 1%é¡¶å¸½å»æå€¼çš„æˆªå°¾ç»Ÿè®¡
- **å¤„ç†æ—¶é—´**: å¸§çº§åˆ«çš„å¤„ç†æ—¶é—´ç»Ÿè®¡
- **åƒç´ è®¡æ•°**: å¤„ç†çš„æ€»åƒç´ æ•°

### ç»Ÿè®¡API
```cpp
// Cæ¥å£
void cph_dctl_add_pq_sample(float pq_max_rgb);
void cph_dctl_record_time(double time_ms);
DCTLStatistics cph_dctl_get_statistics();
void cph_dctl_reset_statistics();

// C++æ¥å£
StatisticsCollector collector;
collector.AddPqMaxRgbSample(0.75f);
collector.RecordFrameProcessingTime(0.85);
auto stats = collector.ComputeCurrentStatistics();
```

## æ•°å€¼ç¨³å®šæ€§

### ä¿æŠ¤æœºåˆ¶
1. **è¾“å…¥éªŒè¯**: æ‰€æœ‰è¾“å…¥å€¼çš„NaN/Infæ£€æµ‹
2. **èŒƒå›´é’³åˆ¶**: å‚æ•°è‡ªåŠ¨é’³åˆ¶åˆ°æœ‰æ•ˆèŒƒå›´
3. **å®‰å…¨æ•°å­¦**: ä½¿ç”¨SafePowã€SafeLogã€SafeDivide
4. **å›é€€ç­–ç•¥**: å¼‚å¸¸æ—¶å›é€€åˆ°çº¿æ€§æ˜ å°„

### ç¡®å®šæ€§æ¨¡å¼
- **ç”¨é€”**: ç¡®ä¿è·¨GPUå¹³å°çš„æ•°å€¼ä¸€è‡´æ€§
- **ç²¾åº¦**: è¯¯å·®â‰¤1 LSBï¼ˆ10/12bité‡åŒ–åï¼‰
- **æ€§èƒ½**: ç•¥ä½äºé»˜è®¤æ¨¡å¼ï¼Œä½†ä¿è¯ä¸€è‡´æ€§

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ€§èƒ½ä¸è¾¾æ ‡
**ç—‡çŠ¶**: å¤„ç†æ—¶é—´è¶…è¿‡ç›®æ ‡å€¼
**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬DCTL
- æ£€æŸ¥GPUé©±åŠ¨æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬
- é™ä½ä¸å¿…è¦çš„å‚æ•°å¤æ‚åº¦
- ç¡®è®¤GPUå†…å­˜å……è¶³

#### 2. é¢œè‰²å¼‚å¸¸
**ç—‡çŠ¶**: å‡ºç°è‰²å½©åç§»æˆ–é¥±å’Œåº¦é—®é¢˜
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥è¾“å…¥è‰²å½©ç©ºé—´æ˜¯å¦æ­£ç¡®
- éªŒè¯å‚æ•°æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
- å°è¯•é‡ç½®ä¸ºé¢„è®¾å‚æ•°
- æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†DCIåˆè§„æ¨¡å¼

#### 3. æ•°å€¼ä¸ä¸€è‡´
**ç—‡çŠ¶**: ä¸åŒGPUè¾“å‡ºç»“æœä¸åŒ
**è§£å†³æ–¹æ¡ˆ**:
- å¯ç”¨ç¡®å®šæ€§æ¨¡å¼
- ç¡®ä¿æ‰€æœ‰å¹³å°ä½¿ç”¨ç›¸åŒçš„å‚æ•°
- æ£€æŸ¥GPUé©±åŠ¨ç‰ˆæœ¬ä¸€è‡´æ€§
- éªŒè¯è¾“å…¥æ•°æ®æ ¼å¼

#### 4. ç»Ÿè®¡ä¿¡æ¯å¼‚å¸¸
**ç—‡çŠ¶**: ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºå¼‚å¸¸å€¼
**è§£å†³æ–¹æ¡ˆ**:
- é‡ç½®ç»Ÿè®¡æ”¶é›†å™¨
- æ£€æŸ¥è¾“å…¥æ•°æ®æœ‰æ•ˆæ€§
- éªŒè¯æ ·æœ¬æ•°é‡æ˜¯å¦å……è¶³
- ç¡®è®¤ç»Ÿè®¡æ”¶é›†çº¿ç¨‹æ­£å¸¸è¿è¡Œ

### è°ƒè¯•å·¥å…·

#### å‚æ•°éªŒè¯
```cpp
DCTLPresetParams params = GetCinemaFlatPreset();
params = ValidateAndClampParams(params);
bool valid = AreParamsValid(params);
```

#### æ€§èƒ½ç›‘æ§
```cpp
ScopedPerformanceMonitor monitor;
// ... å¤„ç†ä»£ç  ...
// ææ„æ—¶è‡ªåŠ¨è®°å½•æ—¶é—´
```

#### ç»Ÿè®¡æŠ¥å‘Š
```cpp
std::string text_report = StatisticsReporter::GenerateTextReport();
std::string json_report = StatisticsReporter::GenerateJsonReport();
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ä¸»DCTLæ–‡ä»¶ä¸­æ·»åŠ ç®—æ³•å®ç°
2. æ›´æ–°å‚æ•°æ˜ å°„å¤´æ–‡ä»¶
3. æ·»åŠ ç›¸åº”çš„ç»Ÿè®¡æ”¶é›†
4. æ›´æ–°é¢„è®¾å‚æ•°
5. ç¼–å†™æµ‹è¯•ç”¨ä¾‹

### æ€§èƒ½ä¼˜åŒ–
1. ä½¿ç”¨å‘é‡åŒ–æ“ä½œ
2. é¿å…åˆ†æ”¯å’Œæ¡ä»¶åˆ¤æ–­
3. é¢„è®¡ç®—å¸¸æ•°
4. ä½¿ç”¨å¿«é€Ÿæ•°å­¦å‡½æ•°
5. å‡å°‘å†…å­˜è®¿é—®

### æµ‹è¯•éªŒè¯
1. æ•°å€¼ç²¾åº¦æµ‹è¯•
2. æ€§èƒ½åŸºå‡†æµ‹è¯•
3. è·¨å¹³å°ä¸€è‡´æ€§æµ‹è¯•
4. è§†è§‰è´¨é‡è¯„ä¼°
5. å›å½’æµ‹è¯•

## ç‰ˆæœ¬å†å²

### v1.0 (å½“å‰ç‰ˆæœ¬)
- åˆå§‹DCTLå®ç°
- PPRå’ŒRLOGç®—æ³•æ”¯æŒ
- åŸºç¡€æ€§èƒ½ä¼˜åŒ–
- ç»Ÿè®¡æ”¶é›†ç³»ç»Ÿ
- ä¸‰å¥—é¢„è®¾å‚æ•°

### è®¡åˆ’åŠŸèƒ½
- æ›´å¤šé¢„è®¾å‚æ•°
- é«˜çº§é«˜å…‰ç»†èŠ‚ç®—æ³•
- åŠ¨æ€å‚æ•°è°ƒèŠ‚
- å®æ—¶æ³¢å½¢æ˜¾ç¤º
- è‡ªåŠ¨å‚æ•°ä¼˜åŒ–

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªCinema Pro HDRé¡¹ç›®çš„è®¸å¯è¯æ¡æ¬¾ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»Cinema Pro HDRå¼€å‘å›¢é˜Ÿã€‚